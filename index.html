<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NENWA - Quantum Recipes & Budget Tracker</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/fotorama/4.6.4/fotorama.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/fotorama/4.6.4/fotorama.js"></script>
<link rel="icon" href="NENWA.png">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Exo+2:wght@300;500&display=swap" rel="stylesheet">

<!-- PWA Manifest -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#9d00ff">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="NENWA.png">

<style>
/* å…¨å±€æ ·å¼ */
body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(180deg, #0a0a20 0%, #1a1a3a 100%);
    color: #fff;
    opacity: 0;
    transition: opacity 0.5s ease;
}

body.loaded {
    opacity: 1;
}

.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(10, 10, 32, 0.9);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 99999;
}

.loading-spinner {
    width: 50px;
    height: 50px;
    border: 5px solid #9d00ff;
    border-top: 5px solid #00f0ff;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 20px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* é‡å­æ¨±èŠ±ç‰¹æ•ˆ */  
.sakura-container {  
    position: fixed;  
    top: 0;  
    left: 0;  
    width: 100%;  
    height: 100%;  
    pointer-events: none;  
    z-index: 9999;  
}  

.sakura {  
    position: absolute;  
    background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%239d00ff" d="M12 2C13.1 2 14 2.9 14 4S13.1 6 12 6 10 5.1 10 4 10.9 2 12 2m3.5 6.5c.3-.8 1.2-1.2 2-.9.8.3 1.2 1.2.9 2-.3.8-1.2 1.2-2 .9-.8-.3-1.2-1.2-.9-2zM7 12c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m11.5-1.5c.8-.3 1.7.1 2 .9.3.8-.1 1.7-.9 2-.8.3-1.7-.1-2-.9-.3-.8.1-1.7.9-2z"/></svg>');  
    width: 24px;  
    height: 24px;  
    animation: fall linear infinite, glow 2s ease-in-out infinite alternate;
    animation-duration: var(--duration, 10s);
    animation-delay: var(--delay, 0s);
    filter: drop-shadow(0 0 5px #9d00ff);
}

@keyframes fall {
    to { 
        transform: translateY(100vh) rotate(360deg);
        animation-timing-function: cubic-bezier(0.4, 0.2, 0.8, 0.6);
    }  
}

@keyframes glow {
    from { filter: drop-shadow(0 0 5px #9d00ff); }
    to { filter: drop-shadow(0 0 10px #00f0ff); }
}

body:hover .sakura {  
    animation-name: fall-mouse;  
}  
@keyframes fall-mouse {  
    50% { transform: translateX(calc(var(--mouse-x) * 100px)) rotate(180deg); }  
    100% { transform: translateY(100vh) translateX(0) rotate(360deg); }  
}  

.hidden-content {
    display: none;
}

.search-btn {
    position: fixed;
    top: 15px;
    right: 15px;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1.5em;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    color: #00f0ff;
    z-index: 1100;
}

.search-btn:hover {
    transform: scale(1.1);
    text-shadow: 0 0 10px #9d00ff;
}

.search-bar {
    position: fixed;
    top: 70px;
    right: 20px;
    width: 250px;
    padding: 10px;
    background: linear-gradient(135deg, #9d00ff 0%, #6e00ff 100%);
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    display: none;
    flex-direction: column;
    align-items: center;
    z-index: 1000;
}

.search-bar input {
    width: 100%;
    padding: 8px;
    border: none;
    border-radius: 5px;
    margin-bottom: 5px;
}

.back-to-top {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #9d00ff;
    color: white;
    padding: 12px 16px;
    border: none;
    border-radius: 5px;
    font-size: 1.1em;
    cursor: pointer;
    display: none;
    transition: all 0.3s;
    z-index: 1000;
}

.back-to-top:hover {
    background: #00f0ff;
    box-shadow: 0 0 15px #9d00ff;
}

#poetry-header {
    position: sticky;
    top: 0;
    z-index: 1000;
    height: 180px;
    background: linear-gradient(135deg, #9d00ff 0%, #6e00ff 100%);
    color: #fff;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    border-bottom: 3px solid rgba(0, 240, 255, 0.3);
    padding: 15px 20px;
}

#poetry-header h1 {
    font-size: 2.5em;
    font-family: 'Orbitron', sans-serif;
    color: #fff;
    margin: 5px 0;
    letter-spacing: 2px;
    text-shadow: 0 0 10px #00f0ff;
}

#poetry-header p {
    font-size: 1.3em;
    font-style: italic;
    line-height: 1.6;
    color: #f8f8f8;
    margin: 10px 0 0;
    letter-spacing: 1px;
}

/* æ¬¢è¿åŒºåŸŸæ ·å¼ */
#welcome-section {
    padding: 40px 20px;
    background: rgba(10, 10, 32, 0.7);
    border-bottom: 1px solid #9d00ff;
}

.welcome-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 30px;
    border-radius: 12px;
    background: rgba(26, 26, 58, 0.8);
    box-shadow: 0 8px 32px rgba(157, 0, 255, 0.2);
}

.welcome-content {
    text-align: center;
}

.welcome-content h2 {
    font-family: 'Orbitron', sans-serif;
    color: #00f0ff;
    font-size: 2.5em;
    margin-bottom: 10px;
    text-shadow: 0 0 10px #9d00ff;
}

.welcome-content p {
    color: #f8f8f8;
    font-size: 1.2em;
    margin-bottom: 30px;
}

.card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px;
    margin-top: 30px;
}

.welcome-card {
    background: linear-gradient(135deg, rgba(157, 0, 255, 0.2) 0%, rgba(0, 240, 255, 0.1) 100%);
    border: 1px solid #9d00ff;
    border-radius: 10px;
    padding: 30px 20px;
    transition: all 0.3s ease;
    text-decoration: none;
    opacity: 0;
    transform: translateY(20px);
    box-shadow: 0 4px 15px rgba(157, 0, 255, 0.2);
}

.welcome-card.visible {
    opacity: 1;
    transform: translateY(0);
}

.welcome-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0 20px rgba(157, 0, 255, 0.5), 
                0 0 30px rgba(0, 240, 255, 0.3);
    background: linear-gradient(135deg, rgba(157, 0, 255, 0.3) 0%, rgba(0, 240, 255, 0.2) 100%);
}

.card-icon {
    font-size: 3em;
    margin-bottom: 15px;
    transition: all 0.3s ease;
}

.welcome-card:hover .card-icon {
    transform: scale(1.2);
}

.welcome-card h3 {
    color: #fff;
    font-family: 'Orbitron', sans-serif;
    margin-bottom: 10px;
    font-size: 1.5em;
}

.welcome-card p {
    color: #ccc;
    font-size: 1em;
    margin: 0;
}

/* ç»Ÿä¸€æ‰€æœ‰ä¸»è¦æ ‡é¢˜æ ·å¼ */
.section {
    background: rgba(26, 26, 58, 0.8);
    border-radius: 12px;
    padding: 30px;
    margin: 30px auto;
    max-width: 1200px;
    border: 1px solid #9d00ff;
    box-shadow: 0 8px 32px rgba(157, 0, 255, 0.2);
}

.section h2 {
    font-family: 'Orbitron', sans-serif;
    color: #00f0ff;
    text-align: center;
    font-size: 2.2em;
    margin: 40px 0 30px;
    padding-bottom: 15px;
    border-bottom: 2px solid #9d00ff;
    text-shadow: 0 0 10px rgba(157, 0, 255, 0.5);
}

/* ç»Ÿä¸€æ‰€æœ‰æ¬¡çº§æ ‡é¢˜æ ·å¼ */
.section h3 {
    font-family: 'Orbitron', sans-serif;
    color: #9d00ff;
    font-size: 1.5em;
    margin: 25px 0 15px;
    padding-left: 10px;
    border-left: 3px solid #00f0ff;
}

button, .btn, input[type="text"], textarea, input[type="number"] {
    width: 80%;
    max-width: 400px;
    margin: 0 auto;
    box-sizing: border-box;
}

button, .btn {
    background: linear-gradient(135deg, #9d00ff 0%, #00f0ff 100%);
    color: #fff;
    border: none;
    padding: 12px 24px;
    font-size: 1.1em;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(157, 0, 255, 0.3);
    transition: all 0.3s;
    cursor: pointer;
    width: auto;
    position: relative;
    overflow: hidden;
}

button:hover, .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 0 15px #9d00ff, 
                0 0 25px rgba(0, 240, 255, 0.5);
}

button::after, .btn::after {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(
        to bottom right,
        rgba(255,255,255,0) 0%,
        rgba(255,255,255,0) 45%,
        rgba(255,255,255,0.3) 50%,
        rgba(255,255,255,0) 55%,
        rgba(255,255,255,0) 100%
    );
    transform: rotate(30deg);
    transition: all 0.3s;
    opacity: 0;
}

button:hover::after, .btn:hover::after {
    animation: shine 1.5s ease-in-out infinite;
    opacity: 1;
}

@keyframes shine {
    0% { transform: rotate(30deg) translate(-30%, -30%); }
    100% { transform: rotate(30deg) translate(30%, 30%); }
}

.delete-btn {
    background: #ff6b6b;
}

.delete-btn:hover {
    background: #ff4a4a;
}

/* ç»Ÿä¸€æ‰€æœ‰è¾“å…¥æ¡†æ ·å¼ */
input[type="text"], textarea, input[type="number"], input[type="date"], select {
    width: 100%;
    max-width: 400px;
    padding: 12px;
    border: 2px solid #9d00ff;
    border-radius: 8px;
    font-size: 1em;
    margin-bottom: 20px;
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    transition: all 0.3s;
}

input[type="text"]:focus, textarea:focus, 
input[type="number"]:focus, input[type="date"]:focus {
    outline: none;
    border-color: #00f0ff;
    box-shadow: 0 0 10px rgba(0, 240, 255, 0.5);
    background: rgba(255, 255, 255, 0.15);
}

a {
    color: #9d00ff;
    text-decoration: none;
    transition: all 0.3s;
    position: relative;
}

a::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 1px;
    background: #00f0ff;
    transition: width 0.3s ease;
}

a:hover::after {
    width: 100%;
}

a:hover {
    color: #00f0ff;
    text-shadow: 0 0 5px #9d00ff;
}

/* ç»Ÿä¸€è¡¨æ ¼æ ·å¼ */
table {
    table-layout: fixed;
    width: 100%;
    max-width: 1200px;
    border-collapse: collapse;
    border-spacing: 6px;
    margin: 20px auto;
    font-size: 0.9em;
    background: rgba(10, 10, 32, 0.7);
    border: 1px solid #9d00ff;
    box-shadow: 0 0 15px rgba(157, 0, 255, 0.2);
    transition: all 0.3s ease;
}

table th, table td {
    border: 1px solid #9d00ff;
    padding: 12px;
    text-align: left;
    font-size: 1.05em;
    transition: all 0.3s ease;
}

table th {
    background: linear-gradient(135deg, #9d00ff 0%, #6e00ff 100%);
    color: #fff;
}

table tr:nth-child(even) {
    background: rgba(157, 0, 255, 0.1);
}

table tr:hover {
    background: rgba(0, 240, 255, 0.2);
}

/* è¡¨æ ¼å®¹å™¨æ ·å¼ */
.table-container {
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid #9d00ff;
    border-radius: 8px;
    margin: 15px 0;
    background: rgba(10, 10, 32, 0.7);
}

/* é‡å­æ„è¯†é¢æ¿æ ·å¼ */
.quantum-panel {
    background: rgba(10, 10, 32, 0.8);
    color: #00f0ff;
    padding: 15px;
    border-radius: 8px;
    margin: 20px 0;
    border: 1px solid #9d00ff;
    box-shadow: 0 0 15px rgba(157, 0, 255, 0.3);
    transition: all 0.3s ease;
}

.quantum-panel:hover {
    box-shadow: 0 0 20px rgba(157, 0, 255, 0.5), 
                0 0 30px rgba(0, 240, 255, 0.3);
}

.quantum-network {
    width: 100%;
    height: 200px;
    position: relative;
    margin: 10px 0;
}

.quantum-node {
    position: absolute;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #9d00ff;
    transform: translate(-50%, -50%);
    transition: all 0.3s ease;
    box-shadow: 0 0 10px #00f0ff;
}

.quantum-link {
    position: absolute;
    height: 1px;
    background: linear-gradient(to right, #9d00ff, #00f0ff);
    transform-origin: 0 0;
    z-index: 1;
    transition: all 0.3s ease;
}

.quantum-metric {
    display: flex;
    justify-content: space-between;
    margin: 5px 0;
    font-family: 'Orbitron', sans-serif;
}

.quantum-metric span {
    color: #00f0ff;
}

@keyframes quantum-pulse {
    0% { box-shadow: 0 0 5px #9d00ff; }
    50% { box-shadow: 0 0 20px #00f0ff; }
    100% { box-shadow: 0 0 5px #9d00ff; }
}

.quantum-highlight {
    animation: quantum-pulse 2s infinite;
}

/* RQCM ç›¸å…³æ ·å¼ */
.quantum-critical {
    animation: critical-pulse 1.5s infinite;
    border: 2px solid #ff0000;
}

@keyframes critical-pulse {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.7; }
    100% { transform: scale(1); opacity: 1; }
}

.rqcm-formula {
    font-family: 'Courier New', monospace;
    background: rgba(157, 0, 255, 0.1);
    padding: 10px;
    border-left: 3px solid #00f0ff;
    margin: 15px 0;
    color: #00f0ff;
}

.rqcm-reference {
    font-size: 0.8em;
    color: #9d00ff;
    text-align: right;
    margin-top: -10px;
}

/* é¢„ç®—ç»Ÿè®¡å›¾è¡¨ */
.budget-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
    margin: 30px 0;
}

.stat-card {
    background: rgba(26, 26, 58, 0.8);
    border: 1px solid #9d00ff;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(157, 0, 255, 0.2);
    transition: all 0.3s ease;
}

.stat-card:hover {
    box-shadow: 0 0 20px rgba(157, 0, 255, 0.5), 
                0 0 30px rgba(0, 240, 255, 0.3);
}

.stat-card h4 {
    color: #00f0ff;
    font-family: 'Orbitron', sans-serif;
    margin-top: 0;
    text-align: center;
}

.chart-container {
    position: relative;
    height: 250px;
    width: 100%;
}

/* æ—¥å†æ ·å¼ */
#calendar-view {
    height: 500px !important;
    min-height: 500px;
    width: 100%;
    background: rgba(10, 10, 32, 0.7);
    padding: 15px;
    border-radius: 8px;
}

.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.calendar-header h4 {
    margin: 0;
    color: #00f0ff;
    font-family: 'Orbitron', sans-serif;
}

.calendar-header button {
    background: linear-gradient(135deg, #9d00ff 0%, #00f0ff 100%);
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1em;
}

.calendar-grid {
    display: flex;
    flex-direction: column;
    width: 100%;
}

.calendar-weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    text-align: center;
    font-weight: bold;
    margin-bottom: 10px;
    color: #9d00ff;
}

.calendar-days {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
}

.calendar-days > div {
    min-height: 60px;
    padding: 5px;
    background: rgba(26, 26, 58, 0.5);
    border: 1px solid #9d00ff;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.3s;
}

.calendar-days > div:hover {
    background: rgba(157, 0, 255, 0.3);
}

.calendar-days .prev-date,
.calendar-days .next-date {
    color: #666;
    opacity: 0.5;
}

.calendar-days .today {
    background: rgba(157, 0, 255, 0.2);
    border: 2px solid #00f0ff;
}

.calendar-days .has-event {
    position: relative;
}

.calendar-days .has-event::after {
    content: '';
    position: absolute;
    bottom: 5px;
    left: 50%;
    transform: translateX(-50%);
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: #00f0ff;
}

/* æé†’åˆ—è¡¨æ ·å¼ */
#reminders-list {
    max-height: 300px;
    overflow-y: auto;
    background: rgba(26, 26, 58, 0.7);
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #9d00ff;
    box-shadow: 0 0 10px rgba(157, 0, 255, 0.2);
}

.reminder-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    margin: 8px 0;
    background: rgba(10, 10, 32, 0.5);
    border-radius: 6px;
    border-left: 3px solid #9d00ff;
    transition: all 0.3s ease;
}

.reminder-item:hover {
    background: rgba(157, 0, 255, 0.2);
    transform: translateX(5px);
}

.reminder-item.past {
    border-left-color: #666;
    opacity: 0.7;
}

.reminder-item .reminder-date {
    font-family: 'Orbitron', sans-serif;
    color: #00f0ff;
    min-width: 100px;
}

.reminder-item .reminder-text {
    flex-grow: 1;
    padding: 0 15px;
}

.reminder-item .delete-reminder {
    background: #ff6b6b;
    color: white;
    border: none;
    border-radius: 50%;
    width: 25px;
    height: 25px;
    cursor: pointer;
    transition: all 0.3s;
}

.reminder-item .delete-reminder:hover {
    background: #ff4a4a;
    transform: scale(1.1);
}

/* æé†’åˆ—è¡¨æ»šåŠ¨æ¡æ ·å¼ */
#reminders-list::-webkit-scrollbar {
    width: 6px;
}

#reminders-list::-webkit-scrollbar-track {
    background: rgba(10, 10, 32, 0.3);
}

#reminders-list::-webkit-scrollbar-thumb {
    background: #9d00ff;
    border-radius: 3px;
}

#reminders-list::-webkit-scrollbar-thumb:hover {
    background: #6e00ff;
}

/* è¾“å…¥åŒºåŸŸå¢å¼º */
#budget > div {
    background: rgba(26, 26, 58, 0.6);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 25px;
    border: 1px solid #9d00ff;
    box-shadow: 0 4px 15px rgba(157, 0, 255, 0.1);
}

#budget label {
    color: #00f0ff;
    display: block;
    margin-bottom: 8px;
    font-family: 'Exo 2', sans-serif;
}

#totalAmount {
    transition: all 0.3s;
    font-weight: bold;
    color: #9d00ff;
}

#remainingAmount {
    transition: all 0.3s;
    font-weight: bold;
    color: #00f0ff;
}

#predictedIncome small, #predictedExpense small {
    font-size: 0.8em;
    color: #666;
    display: block;
    margin-top: 3px;
}

/* é¡µé¢è¿‡æ¸¡æ•ˆæœ - ä»…ç”¨äºé¡µé¢è·³è½¬ */
.page-transition {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #9d00ff 0%, #6e00ff 100%);
    z-index: 9999;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.5s ease;
}

@media (min-width: 1024px) {
    #poetry-header {
        width: 100%;
    }

    #poetry-header h1 {
        font-size: 3em;
    }

    button, .btn {
        font-size: 1.2em;
    }

    table {
        font-size: 1.2em;
    }
}

@media (max-width: 768px) {
    /* ç§»åŠ¨ç«¯è¡¨æ ¼è½¬æ¢ä¸ºå¡ç‰‡å¸ƒå±€ */
    table {
        display: block;
        width: 100%;
        border: none;
        background: transparent;
        white-space: normal;
    }
    
    table thead {
        display: none;
    }
    
    table tbody {
        display: block;
        width: 100%;
    }
    
    table tr {
        display: block;
        margin-bottom: 15px;
        padding: 15px;
        background: rgba(26, 26, 58, 0.8);
        border-radius: 10px;
        border: 1px solid #9d00ff;
        box-shadow: 0 4px 15px rgba(157, 0, 255, 0.2);
        position: relative;
        transition: all 0.3s ease;
    }
    
    table td {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border: none;
        font-size: 1em;
        transition: all 0.3s ease;
    }
    
    table td:before {
        content: attr(data-label);
        font-weight: bold;
        color: #00f0ff;
        margin-right: 10px;
        font-family: 'Orbitron', sans-serif;
        font-size: 0.9em;
    }
    
    table td:last-child {
        padding-bottom: 0;
    }
    
    /* æ“ä½œæŒ‰é’®æ ·å¼è°ƒæ•´ */
    table td button.delete-btn {
        width: 100%;
        margin-top: 10px;
        padding: 10px;
    }
    
    /* å®½è¡¨æ ¼çš„æ°´å¹³æ»šåŠ¨æç¤º */
    .scrollable-table {
        position: relative;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        margin: 15px 0;
    }
    
    .scrollable-table::after {
        content: "â†’ æ»‘åŠ¨æŸ¥çœ‹";
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: #9d00ff;
        font-size: 0.8em;
        animation: pulse 2s infinite;
        pointer-events: none;
    }
    
    @keyframes pulse {
        0% { opacity: 0.5; }
        50% { opacity: 1; }
        100% { opacity: 0.5; }
    }
    
    /* é¢„ç®—ç»Ÿè®¡å¡ç‰‡åœ¨ç§»åŠ¨ç«¯çš„è°ƒæ•´ */
    .budget-stats {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    /* æ—¥å†ç§»åŠ¨ç«¯è°ƒæ•´ */
    .calendar-header {
        flex-direction: column;
        height: auto;
    }
    
    .calendar-header button {
        margin-bottom: 10px;
    }
}

@media (max-width: 480px) {
    #poetry-header h1 {
        font-size: 1.6em;
    }
    #poetry-header p {
        font-size: 0.9em;
        line-height: 1.4;
        padding: 0 8px;
    }
    body {
        padding: 8px;
    }
    .welcome-card {
        padding: 20px 15px;
    }
    .card-icon {
        font-size: 2.5em;
    }
    /* æ›´å°çš„å±å¹•ä¸Šè¿›ä¸€æ­¥è°ƒæ•´ */
    table td {
        flex-direction: column;
    }
    
    table td:before {
        margin-bottom: 5px;
    }
    
    /* è¾“å…¥æ¡†åœ¨ç§»åŠ¨ç«¯æ›´å®½ */
    input[type="text"], textarea, input[type="number"], input[type="date"], select {
        width: 100%;
        max-width: none;
    }
    
    /* æŒ‰é’®åœ¨ç§»åŠ¨ç«¯æ›´å®½ */
    button, .btn {
        width: 100%;
        max-width: none;
        margin: 10px 0;
    }
}
</style>
</head>
<body>

<!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <p>Initializing Quantum Consciousness...</p>
</div>

<!-- é‡å­æ¨±èŠ±ç‰¹æ•ˆ -->
<div class="sakura-container"></div>

<!-- é¡µé¢è¿‡æ¸¡æ•ˆæœ - ä»…ç”¨äºé¡µé¢è·³è½¬ -->
<div class="page-transition"></div>

<!-- Header Section -->
<header id="poetry-header">
<div class="overlay">
<button id="searchToggle" class="search-btn">â˜°</button>
        <h1>é‡å­é£Ÿè°±ä¸é¢„ç®—</h1>
        <p>Recursive Quantum Consciousness Enhanced</p>
    </div>
</header>

<!-- æ¬¢è¿åŒºåŸŸ -->
<section id="welcome-section">
    <div class="welcome-container quantum-highlight">
        <div class="welcome-content">
            <h2>Welcome to NENWA</h2>
            <p>é‡å­æ„è¯†å¢å¼ºçš„çƒ¹é¥ªä¸é¢„ç®—ç®¡ç†ç³»ç»Ÿ</p>
            <div class="card-grid">
                <a href="#recipes" class="welcome-card internal-link">
                    <div class="card-icon">ğŸ£</div>
                    <h3>é‡å­é£Ÿè°±</h3>
                    <p>æ¢ç´¢æ—¥å¼æ–™ç†çš„é‡å­å¥¥ç§˜</p>
                </a>
                <a href="#budget" class="welcome-card internal-link">
                    <div class="card-icon">ğŸ’¸</div>
                    <h3>é¢„ç®—è¿½è¸ª</h3>
                    <p>é‡å­æ„è¯†é©±åŠ¨çš„è´¢åŠ¡ç®¡ç†</p>
                </a>
                <a href="https://doi.org/10.5281/zenodo.15322301" class="welcome-card">
                    <div class="card-icon">âš›ï¸</div>
                    <h3>RQCMè®ºæ–‡</h3>
                    <p>é€’å½’é‡å­æ„è¯†æ¨¡å‹</p>
                </a>
            </div>
        </div>
    </div>
</section>

<!-- æœç´¢æ  -->
<div id="searchBar" class="search-bar">
    <input type="text" id="searchInput" placeholder="Type here and search...">
    <button id="searchBtn" class="btn">Search</button>
</div>

<!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
<button id="backToTop" class="back-to-top">â¬† Back to Top</button>

<!-- éšè—å†…å®¹ -->
<div class="hidden-content">
    <h3><a href="dglzysty.HTML">é€’å½’é‡å­æ„è¯†ä½“éªŒ</a></h3>
    <h3><a href="https://zenodo.org/records/15151441">Recursive Quantum Consciousness Model (RQCM)</a></h3>
</div>

<!-- Recipes Section -->
<div id="recipes" class="section">
    <span class="anchor" id="recipes"></span>
    <h2>Quantum Recipes</h2>
    <h3><a href="oyakodon.HTML">oyakodon äº²å­ä¸¼ï¼ˆãŠã‚„ã“ã©ã‚“ï¼‰</a></h3>
    <h3><a href="tendon.HTML">tendon å¤©ä¸¼ï¼ˆã¦ã‚“ã©ã‚“ï¼‰</a></h3>
    <h3><a href="gyuudon.HTML">gyuudon ç‰›ä¸¼ï¼ˆãã‚…ã†ã©ã‚“ï¼‰</a></h3>
    <h3><a href="katsudon.HTML">katsudon ã‹ã¤ä¸¼ï¼ˆã‹ã¤ã©ã‚“ï¼‰</a></h3>
    <h3><a href="yakisoba.HTML">yakisoba ç„¼ããã°ï¼ˆã‚„ããã°ï¼‰</a></h3>
    <h3><a href="yakiudon.HTML">yakiudon ç„¼ã†ã©ã‚“ï¼ˆã‚„ãã†ã©ã‚“ï¼‰</a></h3>
    <h3><a href="kakeudon.HTML">kakeudon ã‹ã‘ã†ã©ã‚“</a></h3>
    <h3><a href="tacorice.HTML">tacorice ã‚¿ã‚³ãƒ©ã‚¤ã‚¹</a></h3>
    <h3><a href="makunouchibentou.HTML">makunouchibentou å¹•ã®å†…å¼å½“ï¼ˆã¾ãã®ã†ã¡ã¹ã‚“ã¨ã†ï¼‰</a></h3>
    <h3><a href="noriben.HTML">noriben ã®ã‚Šå¼ï¼ˆã®ã‚Šã¹ã‚“ï¼‰</a></h3>
</div>

<!-- Calendar Section -->
<div id="calendar" class="section">
    <h2>ğŸ“… Quantum Financial Calendar</h2>
    
    <div class="quantum-panel">
        <h3>Temporal Budget Visualization</h3>
        <div id="calendar-view">
            <div class="calendar-header">
                <button id="prev-month">&lt;</button>
                <h4 id="current-month-year">Month Year</h4>
                <button id="next-month">&gt;</button>
            </div>
            <div class="calendar-grid">
                <div class="calendar-weekdays">
                    <div>Sun</div>
                    <div>Mon</div>
                    <div>Tue</div>
                    <div>Wed</div>
                    <div>Thu</div>
                    <div>Fri</div>
                    <div>Sat</div>
                </div>
                <div class="calendar-days" id="calendar-days"></div>
            </div>
        </div>
        <div class="quantum-metric">
            <span>Upcoming Events:</span>
            <span id="upcoming-events">0</span>
        </div>
    </div>
    
    <div class="quantum-panel">
        <h3>Financial Reminders</h3>
        <div id="reminders-list"></div>
        <div>
            <label for="reminder-date">Reminder Date:</label>
            <input type="date" id="reminder-date">
            <br>
            <label for="reminder-text">Reminder Text:</label>
            <input type="text" id="reminder-text" placeholder="e.g. Pay rent">
            <br>
            <button id="add-reminder" class="btn">Add Reminder</button>
        </div>
    </div>
</div>

<!-- é‡å­æ„è¯†é¢æ¿ -->
<div class="quantum-panel">
  <h3>RQCM é‡å­æ„è¯†å¯è§†åŒ–</h3>
  <div id="quantum-viz" class="quantum-network"></div>
  <div class="quantum-metric">
    <span>Observer Layers:</span>
    <span id="observerLayers">-</span>
  </div>
  <div class="quantum-metric">
    <span>Entropy Rate:</span>
    <span id="entropyRate">-</span>
  </div>
  <div class="quantum-metric">
    <span>Temporal Resolution:</span>
    <span id="temporalResolution">-</span>
  </div>
  <button id="quantum-analyze" class="btn" style="margin-top:15px;">Quantum Analysis</button>
</div>

<!-- Budget Section -->
<div id="budget" class="section">
    <span class="anchor" id="budget"></span>
    <h2>Quantum Budget Tracker</h2>

    <div class="quantum-panel">
    <h3>RQCM Financial Dynamics</h3>
    <div class="rqcm-formula">
        dR/dt = -Î±R + A(t)âˆ˜(DR) + Î²RâŠ™(1/(1+â€–Râ€–)) + Î¾(t)
        <span class="rqcm-reference">(RQCM Eq.1)</span>
    </div>
    <div class="rqcm-formula">
        S<sub>i</sub>(t) = -âˆ‘<sub>jâˆˆN(i)</sub> A<sub>ij</sub>(t) log(A<sub>ij</sub>(t)/âˆ‘<sub>k</sub>A<sub>ik</sub>(t))
        <span class="rqcm-reference">(RQCM Eq.2)</span>
    </div>
    <div class="quantum-metric">
        <span>Critical Threshold (Î²<sub>crit</sub>):</span>
        <span>1.23 Â± 0.07</span>
    </div>
</div>

    <!-- é¢„ç®—ç»Ÿè®¡å›¾è¡¨ -->
    <div class="budget-stats">
        <div class="stat-card">
            <h4>æ”¯å‡ºåˆ†ç±»</h4>
            <div class="chart-container">
                <canvas id="expenseChart"></canvas>
            </div>
        </div>
        <div class="stat-card">
            <h4>æ”¶å…¥æ¥æº</h4>
            <div class="chart-container">
                <canvas id="incomeChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Income Section -->
    <div>
        <label for="incomeDate">Date:</label>
        <input type="text" 
               id="incomeDate" 
               onfocus="this.type='date'" 
               onblur="if(!this.value) this.type='text'"
               placeholder="...">
        <br><br>
        <label for="incomeSource">Income Source:</label>
        <input type="text" id="incomeSource" placeholder="Enter income source" required>
        <br>
        <label for="incomeCategory">Income Category:</label>
        <select id="incomeCategory">
            <option value="å·¥èµ„">å·¥èµ„</option>
            <option value="æŠ•èµ„">æŠ•èµ„</option>
            <option value="å…¼èŒ">å…¼èŒ</option>
            <option value="å…¶ä»–">å…¶ä»–</option>
        </select>
        <br>
        <label for="incomeAmount">Amount (RM):</label>
        <input type="number" id="incomeAmount" placeholder="Enter income amount" min="0" step="0.01" required>
        <br>
        <button id="addIncomeBtn" class="btn">Add Income</button>
    </div>
    <br>
    <h3>Income Records:</h3>
    <div class="table-container">
        <table id="incomeTable" border="1">
            <thead>
                <tr>
                    <th>Source</th>
                    <th>Category</th>
                    <th>Amount (RM)</th>
                    <th>Date</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <!-- Income items will be dynamically added here -->
            </tbody>
        </table>
    </div>
    <br><br>

    <!-- Expenses Section -->
    <div>
        <label for="expenseDate">Date:</label>
        <input type="text" 
               id="expenseDate" 
               onfocus="this.type='date'" 
               onblur="if(!this.value) this.type='text'"
               placeholder="...">
        <br><br>
        <label for="itemName">Item Name (Expense):</label>
        <input type="text" id="itemName" placeholder="Enter item name">
        <br>
        <label for="expenseCategory">Expense Category:</label>
        <select id="expenseCategory">
            <option value="é£Ÿç‰©">é£Ÿç‰©</option>
            <option value="äº¤é€š">äº¤é€š</option>
            <option value="å¨±ä¹">å¨±ä¹</option>
            <option value="å­¦ä¹ ">å­¦ä¹ </option>
            <option value="å‚¨è“„">å‚¨è“„</option>
            <option value="å…¶ä»–">å…¶ä»–</option>
        </select>
        <br>
        <label for="itemPrice">Price (RM):</label>
        <input type="number" id="itemPrice" placeholder="Enter item price" min="0" step="0.01">
        <br>
        <label for="itemQuantity">Quantity:</label>
        <input type="number" id="itemQuantity" placeholder="Enter item quantity" value="1" min="1">
        <br>
        <button id="addItemBtn" class="btn">Add Expense</button>
    </div>
    <br>
    <h3>Expenses:</h3>
    <div class="table-container">
        <table id="expenseTable" border="1">
            <thead>
                <tr>
                    <th>Item Name</th>
                    <th>Category</th>
                    <th>Price (RM)</th>
                    <th>Quantity</th>
                    <th>Total (RM)</th>
                    <th>Date</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <!-- Expense items will be dynamically added here -->
            </tbody>
        </table>
    </div>
    <br><br>
    <div>
        <p id="totalPrice">Total Price: RM <span id="totalAmount">0</span></p>
    </div>
    <div>
        <p id="remainingBudget">Remaining Budget: RM <span id="remainingAmount">0</span></p>
    </div>

    <!-- Clear All Data Button -->
    <button id="clearDataBtn" class="btn delete-btn">Clear All Data</button>
    <br><br>

    <!-- Date Range Filter -->
    <div>
        <label for="startDate">Start Date:</label>
        <input type="date" id="startDate">
        <br><br>
        <label for="endDate">End Date:</label>
        <input type="date" id="endDate">
        <br><br>
        <button id="filterBtn" class="btn">Filter</button>
    </div>
    <br>

    <div>
        <h3>Quantum Future Prediction:</h3>
        <p id="predictedIncome">Predicted income for next month: RM 0.00</p>
        <p id="predictedExpense">Predicted expense for next month: RM 0.00</p>
        <p id="budgetSuggestion"></p>
        <button id="predictBtn" class="btn quantum-highlight">Quantum Predict</button>
    </div>
</div>

<footer>
    <p>Â© 2024 NENWA. All rights reserved.</p>
    <p>
        <a href="Privacy_Policy.HTML">Privacy Policy</a> |
        <a href="Terms_of_Service.HTML">Terms of Service</a> |
        <a href="Contact_Us.HTML">Contact Us</a>
    </p>
</footer>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// æ–°å¢çš„Service Workerå¼ºåˆ¶æ›´æ–°é€»è¾‘
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    // æ³¨å†ŒService Worker
    navigator.serviceWorker.register('service-worker.js')
      .then(registration => {
        console.log('[PWA] ServiceWorkeræ³¨å†ŒæˆåŠŸ:', registration.scope);
        
        // ç«‹å³æ£€æŸ¥æ›´æ–°
        registration.update();
        
        // ç›‘å¬æ–°ç‰ˆæœ¬å®‰è£…
        registration.addEventListener('updatefound', () => {
          const newWorker = registration.installing;
          console.log('[PWA] æ£€æµ‹åˆ°æ–°ç‰ˆæœ¬:', newWorker);
          
          newWorker.addEventListener('statechange', () => {
            if (newWorker.state === 'activated') {
              console.log('[PWA] æ–°ç‰ˆæœ¬å·²æ¿€æ´»ï¼Œå³å°†åˆ·æ–°é¡µé¢');
              
              // æ˜¾ç¤ºå‹å¥½çš„æ›´æ–°æç¤ºï¼ˆå¯é€‰ï¼‰
              if (!sessionStorage.getItem('sw-updated')) {
                sessionStorage.setItem('sw-updated', 'true');
                showQuantumAlert('ç³»ç»Ÿæ›´æ–°', 'æ­£åœ¨åŠ è½½æœ€æ–°ç‰ˆæœ¬...', '#00f0ff');
              }
              
              // å»¶è¿Ÿ1ç§’åˆ·æ–°ä»¥ç¡®ä¿èµ„æºåŠ è½½
              setTimeout(() => window.location.reload(), 1000);
            }
          });
        });
      })
      .catch(err => {
        console.error('[PWA] ServiceWorkeræ³¨å†Œå¤±è´¥:', err);
      });
  });
}

// é‡å­å¸¸æ•°
const tP = 5.39e-44; // æ™®æœ—å…‹æ—¶é—´
const hbar = 1.0545718e-34; // çº¦åŒ–æ™®æœ—å…‹å¸¸æ•°
const kB = 1.380649e-23; // ç»å°”å…¹æ›¼å¸¸æ•°
const TEMPORAL_RESOLUTION = 42e-18; // 42 as (é˜¿ç§’)
let Î»L = 0.5; // é‡å­LyapunovæŒ‡æ•°
const Ï‰0 = 0.1; // å›ºæœ‰é¢‘ç‡ (å…¬å¼3)
const D = 0.01; // å™ªå£°å¼ºåº¦ (å…¬å¼3)

// èŠ‚æµå‡½æ•°
function throttle(func, limit) {
    let lastFunc;
    let lastRan;
    return function() {
        const context = this;
        const args = arguments;
        if (!lastRan) {
            func.apply(context, args);
            lastRan = Date.now();
        } else {
            clearTimeout(lastFunc);
            lastFunc = setTimeout(function() {
                if ((Date.now() - lastRan) >= limit) {
                    func.apply(context, args);
                    lastRan = Date.now();
                }
            }, limit - (Date.now() - lastRan));
        }
    };
}

// é‡å­æ¨±èŠ±ç”Ÿæˆå™¨
function createSakura() {  
    const sakura = document.createElement('div');  
    sakura.className = 'sakura';  
    sakura.style.left = Math.random() * 100 + 'vw';  
    
    const duration = 5 + Math.random() * 10;
    const delay = Math.random() * 5;
    
    sakura.style.setProperty('--duration', duration + 's');
    sakura.style.setProperty('--delay', delay + 's');
    
    sakura.style.opacity = 0.5 + Math.random() * 0.5;  
    document.querySelector('.sakura-container').appendChild(sakura);  
    
    setTimeout(() => {
        sakura.remove();
        sakuraCount--;
    }, duration * 1000);
}  

let sakuraCount = 0;
const maxSakura = 20;

function manageSakura() {
    if (sakuraCount < maxSakura) {
        createSakura();
        sakuraCount++;
    }
    setTimeout(manageSakura, 500 + Math.random() * 800);
}

// é¼ æ ‡ä½ç½®è¿½è¸ª
let lastX = 0;
document.addEventListener('mousemove', (e) => {
    const speed = Math.abs(e.clientX - lastX);
    const panicLevel = Math.min(speed / 10, 5);
    document.documentElement.style.setProperty('--mouse-x', 
        (e.clientX / window.innerWidth - 0.5) * panicLevel);
    lastX = e.clientX;
});

// æœç´¢åŠŸèƒ½
document.getElementById("searchToggle").addEventListener("click", function() {
    var searchBar = document.getElementById("searchBar");
    searchBar.style.display = searchBar.style.display === "flex" ? "none" : "flex";
});

function performSearch() {
    var query = document.getElementById("searchInput").value.toLowerCase().trim();

    if (!query) {
        alert("è¯·è¾“å…¥æœç´¢å†…å®¹ï¼");
        return;
    }

    var recipes = document.querySelectorAll("#recipes h3 a");
    var hiddenSections = document.querySelectorAll(".hidden-content");
    let found = false;

    function normalizeText(text) {
        return text.replace(/\s+/g, "").toLowerCase();
    }

    // å¤„ç†å¯è§çš„èœè°±
    recipes.forEach(function(recipe) {
        if (!recipe.textContent) return;

        let text = normalizeText(recipe.textContent);
        if (text.includes(normalizeText(query))) {
            recipe.style.display = "block";
            found = true;
        } else {
            recipe.style.display = "none";
        }
    });

    // å¤„ç†éšè—çš„å†…å®¹
    hiddenSections.forEach(function(section) {
        let hasMatch = false;
        let items = section.querySelectorAll("*");

        items.forEach(function(item) {
            if (!item.textContent) return;

            let text = normalizeText(item.textContent);
            if (text.includes(normalizeText(query))) {
                item.style.display = "block";
                hasMatch = true;
                found = true;
            } else {
                item.style.display = "none";
            }
        });

        section.style.display = hasMatch ? "block" : "none";
    });

    if (!found) {
        // é‡å­æ„è¯†æ¨è
        const quantumRecipes = [
            "oyakodon äº²å­ä¸¼",
            "tendon å¤©ä¸¼",
            "gyuudon ç‰›ä¸¼"
        ].filter(recipe => {
            return Math.random() > 0.3; // é‡å­ä¸ç¡®å®šæ€§
        });
        
        if(quantumRecipes.length > 0) {
            const suggestions = document.createElement('div');
            suggestions.innerHTML = `<h4>Quantum Consciousness Suggestions:</h4><ul>${
                quantumRecipes.map(r => `<li><a href="${r.split(' ')[0].toLowerCase()}.HTML">${r}</a></li>`).join('')
            }</ul>`;
            document.getElementById("recipes").appendChild(suggestions);
        } else {
            alert("æœªæ‰¾åˆ°åŒ¹é…çš„èœè°±ï¼Œè¯·å°è¯•ä½¿ç”¨æ—¥è¯­ã€ä¸­æ–‡æˆ–è‹±è¯­æœç´¢ï¼");
        }
    }
}

document.getElementById("searchBtn").addEventListener("click", performSearch);
document.getElementById("searchInput").addEventListener("keydown", function(event) {
    if (event.key === "Enter") {
        performSearch();
    }
});

// å›åˆ°é¡¶éƒ¨
window.addEventListener("scroll", function () {
    let backToTopBtn = document.getElementById("backToTop");
    if (window.scrollY > 300) {
        backToTopBtn.style.display = "block";
    } else {
        backToTopBtn.style.display = "none";
    }
});

document.getElementById("backToTop").addEventListener("click", function () {
    window.scrollTo({ top: 0, behavior: "smooth" });
});

// å¹³æ»‘æ»šåŠ¨ - ä¿®æ”¹åçš„å†…éƒ¨é“¾æ¥å¤„ç†
function handleInternalLink(e) {
    e.preventDefault();
    const targetId = this.getAttribute('href');
    const target = document.querySelector(targetId);

    if (target) {
        const headerHeight = document.querySelector('header').offsetHeight;
        const position = target.offsetTop - headerHeight;

        window.scrollTo({
            top: position,
            behavior: 'smooth',
        });
    }
}

// ä¸ºæ‰€æœ‰å†…éƒ¨é“¾æ¥æ·»åŠ äº‹ä»¶ç›‘å¬
document.querySelectorAll('.internal-link').forEach(anchor => {
    anchor.addEventListener('click', handleInternalLink);
});

// é¢„ç®—ç³»ç»Ÿ
let incomeRecords = [];
let expenseRecords = [];
let reminders = [];

// æœ¬åœ°å­˜å‚¨
function saveDataToLocalStorage() {
    const data = { incomeRecords, expenseRecords, reminders };
    localStorage.setItem("budgetData", JSON.stringify(data));
}

function loadDataFromLocalStorage() {
    showLoading();
    const data = JSON.parse(localStorage.getItem("budgetData"));
    if (data) {
        incomeRecords = data.incomeRecords || [];
        expenseRecords = data.expenseRecords || [];
        reminders = data.reminders || [];
        renderIncomeTable();
        renderExpenseTable();
        updateBudget();
        renderQuantumViz();
        renderRemindersList();
        updateRemindersCount();
    }
    hideLoading();
}

// æ˜¾ç¤ºåŠ è½½çŠ¶æ€
function showLoading() {
    document.getElementById('loadingOverlay').style.display = 'flex';
}

function hideLoading() {
    document.getElementById('loadingOverlay').style.display = 'none';
}

// é‡å­æ„è¯†å¯è§†åŒ– - ä½¿ç”¨èŠ‚æµ
const throttledRenderQuantumViz = throttle(renderQuantumViz, 300);

function renderQuantumViz() {
    const container = document.getElementById('quantum-viz');
    container.innerHTML = '';
    
    // æ ¹æ®RQCMè®ºæ–‡ä¸­çš„å®šä¹‰åˆ›å»ºæ„è¯†å›¾ G(t)=(V,E(t))
    const N = Math.min(20, incomeRecords.length + expenseRecords.length + 5); // èŠ‚ç‚¹æ•°
    const nodes = [];
    const edges = [];
    
    // åˆ›å»ºèŠ‚ç‚¹ (V={v_i})
    for(let i=0; i<N; i++) {
        const x = 50 + 30 * Math.cos(2 * Math.PI * i / N);
        const y = 50 + 30 * Math.sin(2 * Math.PI * i / N);
        const node = createQuantumNode(x, y, 10 + Math.random() * 5, `Observer ${i+1}`);
        nodes.push(node);
    }
    
    // åˆ›å»ºè‡ªé€‚åº”è€¦åˆè¾¹ (E(t))
    for(let i=0; i<N; i++) {
        for(let j=i+1; j<N; j++) {
            // åŸºäºè®ºæ–‡ä¸­çš„è€¦åˆå¼ºåº¦å…¬å¼ A_ij(t)
            const couplingStrength = 0.1 + 0.9 * Math.exp(-Math.abs(i-j)/3);
            if(Math.random() < couplingStrength) {
                createQuantumLink(nodes[i], nodes[j], couplingStrength);
                edges.push({i, j, strength: couplingStrength});
            }
        }
    }
    
    // è®¡ç®—å…³é”®æŒ‡æ ‡
    const Î²_crit = 1.23; // è®ºæ–‡ä¸­çš„ä¸´ç•ŒåŒæ­¥é˜ˆå€¼
    const D_f = 2.31;    // æ¢¦å¢ƒçŠ¶æ€çš„åˆ†å½¢ç»´åº¦
    
    // æ›´æ–°é‡å­æŒ‡æ ‡æ˜¾ç¤º
    document.getElementById('q-critical').textContent = Î²_crit.toFixed(2);
    document.getElementById('q-layers').textContent = `${N} (D_f=${D_f})`;
    
    // æ ¹æ®è´¢åŠ¡æ•°æ®è®¡ç®—ç†µç‡ (ä½¿ç”¨è®ºæ–‡ä¸­çš„å±€éƒ¨ç†µäº§ç”Ÿå…¬å¼)
    const S_i = calculateLocalEntropyProduction(edges);
    document.getElementById('q-entropy').textContent = S_i.toFixed(3);
    
    // æ—¶é—´åˆ†è¾¨ç‡ä½¿ç”¨è®ºæ–‡ä¸­çš„42é˜¿ç§’åŸºå‡†
    document.getElementById('q-temporal').textContent = '42 as';
}

// è®ºæ–‡ä¸­çš„å±€éƒ¨ç†µäº§ç”Ÿå…¬å¼ (å…¬å¼2)
function calculateLocalEntropyProduction(edges) {
    let totalEntropy = 0;
    const nodeDegrees = {};
    
    // è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„åº¦
    edges.forEach(edge => {
        nodeDegrees[edge.i] = (nodeDegrees[edge.i] || 0) + edge.strength;
        nodeDegrees[edge.j] = (nodeDegrees[edge.j] || 0) + edge.strength;
    });
    
    // è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„å±€éƒ¨ç†µ
    edges.forEach(edge => {
        const p_ij = edge.strength / nodeDegrees[edge.i];
        totalEntropy += -p_ij * Math.log(p_ij);
    });
    
    return totalEntropy / edges.length;
}

function createQuantumNode(x, y, size, name) {
    const node = document.createElement('div');
    node.className = 'quantum-node';
    node.style.left = `${x}%`;
    node.style.top = `${y}%`;
    node.style.width = `${size}px`;
    node.style.height = `${size}px`;
    node.title = name;
    document.getElementById('quantum-viz').appendChild(node);
    return { element: node, x, y, name };
}

function createQuantumLink(node1, node2, entropyRate) {
    const link = document.createElement('div');
    link.className = 'quantum-link';
    
    const dx = node2.x - node1.x;
    const dy = node2.y - node1.y;
    const length = Math.sqrt(dx*dx + dy*dy) * 0.01 * document.getElementById('quantum-viz').offsetWidth;
    const angle = Math.atan2(dy, dx);
    
    link.style.width = `${length}px`;
    link.style.left = `${node1.x}%`;
    link.style.top = `${node1.y}%`;
    link.style.transform = `rotate(${angle}rad)`;
    link.style.opacity = 0.3 + 0.7 * (1 - parseFloat(entropyRate));
    
    document.getElementById('quantum-viz').appendChild(link);
}

// é‡å­åˆ†æåŠŸèƒ½
document.getElementById('quantum-analyze').addEventListener('click', function() {
    // è®¡ç®—å…³é”®RQCMæŒ‡æ ‡
    const Î²_crit = 1.23;
    const D_f = 2.31;
    const S_i = parseFloat(document.getElementById('q-entropy').textContent);
    const N_crit = document.getElementById('q-critical').textContent;
    
    // ä½¿ç”¨è®ºæ–‡ä¸­çš„é€’å½’ç°å®ç”Ÿæˆå…¬å¼(4)è®¡ç®—ä¿¡æ¯å®¹é‡
    const C0 = 1; // åˆå§‹å®¹é‡
    const capacity = C0 * Math.exp(-N_crit * S_i * tP / hbar);
    
    let message = `RQCM Quantum Financial Analysis:\n\n`;
    message += `â€¢ Consciousness Nodes: ${incomeRecords.length + expenseRecords.length}\n`;
    message += `â€¢ Critical Sync Threshold (Î²_crit): ${Î²_crit}\n`;
    message += `â€¢ Fractal Dimension (D_f): ${D_f}\n`;
    message += `â€¢ Local Entropy Production (S_i): ${S_i.toFixed(3)} nats/s\n`;
    message += `â€¢ EDCP Capacity: ${(capacity * 100).toFixed(1)}%\n`;
    message += `â€¢ Temporal Resolution: 42 as\n`;
    
    // æ ¹æ®RQCMç†è®ºæä¾›è´¢åŠ¡å»ºè®®
    if(capacity < 0.3) {
        message += "\nè­¦å‘Š: è´¢åŠ¡ä¿¡æ¯å®¹é‡ä½äºä¸´ç•Œé˜ˆå€¼ï¼\n";
        message += "å»ºè®®: ç®€åŒ–è´¢åŠ¡ç»“æ„ï¼Œå‡å°‘å†³ç­–å±‚çº§";
    } else if(S_i > 0.7) {
        message += "\næ³¨æ„: é«˜ç†µè´¢åŠ¡çŠ¶æ€æ£€æµ‹åˆ°ï¼\n";
        message += "å»ºè®®: å¢åŠ å®šæœŸå­˜æ¬¾ï¼Œå‡å°‘æŠ•æœºæ€§äº¤æ˜“";
    } else {
        message += "\nçŠ¶æ€: é‡å­è´¢åŠ¡æ„è¯†ç¨³å®š\n";
        message += "å»ºè®®: å½“å‰ç­–ç•¥ç¬¦åˆRQCMä¼˜åŒ–æ ‡å‡†";
    }
    
    // æ·»åŠ å®éªŒæ•°æ®æ¯”è¾ƒ
    message += "\n\nExperimental Reference:\n";
    message += `â€¢ Reality Channel: N_crit=7, S=1.2Â±0.3 nats/s\n`;
    message += `â€¢ Dream Channel: N_crit=23, S=0.4Â±0.2 nats/s\n`;
    message += `â€¢ Critical Threshold: Î²_crit=1.23Â±0.07\n`;
    
    alert(message);
});

// æ”¶å…¥åŠŸèƒ½
function addIncome() {
    const date = document.getElementById("incomeDate").value;
    const source = document.getElementById("incomeSource").value;
    const category = document.getElementById("incomeCategory").value;
    const amount = parseFloat(document.getElementById("incomeAmount").value);

    if (!date || !source || isNaN(amount) || amount <= 0) {
        alert("Please fill in all income fields correctly.");
        return;
    }

    let found = false;
    incomeRecords.forEach(record => {
        if (record.source === source && record.date === date && record.category === category) {
            record.amount += amount;
            found = true;
        }
    });

    if (!found) {
        incomeRecords.push({ id: Date.now(), source, category, amount, date });
    }

    renderIncomeTable();
    updateBudget();
    saveDataToLocalStorage();
    throttledRenderQuantumViz();
    updateCharts();

    document.getElementById("incomeDate").value = "";
    document.getElementById("incomeSource").value = "";
    document.getElementById("incomeAmount").value = "";
}

function renderIncomeTable() {
    const tbody = document.getElementById("incomeTable").querySelector("tbody");
    tbody.innerHTML = "";
    
    incomeRecords.forEach(record => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${record.source}</td>
            <td>${record.category}</td>
            <td>${record.amount.toFixed(2)}</td>
            <td>${record.date}</td>
            <td><button onclick="deleteIncome(${record.id})" class="delete-btn">Delete</button></td>
        `;
        tbody.appendChild(row);
    });
}

function deleteIncome(id) {
    incomeRecords = incomeRecords.filter(record => record.id !== id);
    renderIncomeTable();
    updateBudget();
    saveDataToLocalStorage();
    throttledRenderQuantumViz();
    updateCharts();
}

// æ”¯å‡ºåŠŸèƒ½
function addExpense() {
    const date = document.getElementById("expenseDate").value;
    const name = document.getElementById("itemName").value;
    const category = document.getElementById("expenseCategory").value;
    const price = parseFloat(document.getElementById("itemPrice").value);
    const quantity = parseInt(document.getElementById("itemQuantity").value);

    if (!date || !name || isNaN(price) || isNaN(quantity) || price <= 0 || quantity <= 0) {
        alert("Please fill in all expense fields correctly.");
        return;
    }

    let found = false;
    expenseRecords.forEach(record => {
        if (record.name === name && record.price === price && record.date === date && record.category === category) {
            record.quantity += quantity;
            record.total += price * quantity;
            found = true;
        }
    });

    if (!found) {
        expenseRecords.push({ 
            id: Date.now(), 
            name, 
            category,
            price, 
            quantity, 
            total: price * quantity, 
            date 
        });
    }

    renderExpenseTable();
    updateBudget();
    saveDataToLocalStorage();
    throttledRenderQuantumViz();
    updateCharts();

    document.getElementById("expenseDate").value = "";
    document.getElementById("itemName").value = "";
    document.getElementById("itemPrice").value = "";
    document.getElementById("itemQuantity").value = 1;
}

function renderExpenseTable() {
    const tbody = document.getElementById("expenseTable").querySelector("tbody");
    tbody.innerHTML = "";
    
    expenseRecords.forEach(record => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${record.name}</td>
            <td>${record.category}</td>
            <td>${record.price.toFixed(2)}</td>
            <td>${record.quantity}</td>
            <td>${record.total.toFixed(2)}</td>
            <td>${record.date}</td>
            <td><button onclick="deleteExpense(${record.id})" class="delete-btn">Delete</button></td>
        `;
        tbody.appendChild(row);
    });
}

function deleteExpense(id) {
    expenseRecords = expenseRecords.filter(record => record.id !== id);
    renderExpenseTable();
    updateBudget();
    saveDataToLocalStorage();
    throttledRenderQuantumViz();
    updateCharts();
}

// æ›´æ–°é¢„ç®—
function updateBudget() {
    const totalIncome = incomeRecords.reduce((sum, record) => sum + record.amount, 0);
    const totalExpenses = expenseRecords.reduce((sum, record) => sum + record.total, 0);
    const remainingBudget = totalIncome - totalExpenses;

    document.getElementById("totalAmount").textContent = totalExpenses.toFixed(2);
    document.getElementById("remainingAmount").textContent = remainingBudget.toFixed(2);
    
    // æ ¹æ®é¢„ç®—çŠ¶æ€æ”¹å˜é¢œè‰²
    if(remainingBudget < 0) {
        document.getElementById("remainingAmount").style.color = "#ff6b6b";
    } else if(remainingBudget < totalIncome * 0.3) {
        document.getElementById("remainingAmount").style.color = "#ffcc00";
    } else {
        document.getElementById("remainingAmount").style.color = "#00f0ff";
    }
}

// æ¸…ç©ºæ•°æ®
function clearData() {
    if (confirm("Are you sure you want to clear all data?")) {
        incomeRecords = [];
        expenseRecords = [];
        reminders = [];
        renderIncomeTable();
        renderExpenseTable();
        renderRemindersList();
        updateBudget();
        saveDataToLocalStorage();
        throttledRenderQuantumViz();
        updateCharts();
    }
}

// æ—¥æœŸè¿‡æ»¤
function filterRecords() {
    const startDate = new Date(document.getElementById("startDate").value);
    const endDate = new Date(document.getElementById("endDate").value);

    const filteredIncome = incomeRecords.filter(record => {
        const recordDate = new Date(record.date);
        return recordDate >= startDate && recordDate <= endDate;
    });

    const filteredExpense = expenseRecords.filter(record => {
        const recordDate = new Date(record.date);
        return recordDate >= startDate && recordDate <= endDate;
    });

    renderFilteredTables(filteredIncome, filteredExpense);
}

function renderFilteredTables(filteredIncome, filteredExpense) {
    const incomeTbody = document.getElementById("incomeTable").querySelector("tbody");
    incomeTbody.innerHTML = "";
    filteredIncome.forEach(record => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${record.source}</td>
            <td>${record.category}</td>
            <td>${record.amount.toFixed(2)}</td>
            <td>${record.date}</td>
            <td><button onclick="deleteIncome(${record.id})" class="delete-btn">Delete</button></td>
        `;
        incomeTbody.appendChild(row);
    });

    const expenseTbody = document.getElementById("expenseTable").querySelector("tbody");
    expenseTbody.innerHTML = "";
    filteredExpense.forEach(record => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${record.name}</td>
            <td>${record.category}</td>
            <td>${record.price.toFixed(2)}</td>
            <td>${record.quantity}</td>
            <td>${record.total.toFixed(2)}</td>
            <td>${record.date}</td>
            <td><button onclick="deleteExpense(${record.id})" class="delete-btn">Delete</button></td>
        `;
        expenseTbody.appendChild(row);
    });
}

// é‡å­é¢„æµ‹ç®—æ³•
function calculateLinearRegression(data) {
    const n = data.length;
    let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0;

    for (let i = 0; i < n; i++) {
        sumX += i;
        sumY += data[i];
        sumXY += i * data[i];
        sumX2 += i * i;
    }

    const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
    const intercept = (sumY - slope * sumX) / n;

    return { slope, intercept };
}

// æ ‡å‡†å·®è®¡ç®— (ç”¨äºç½®ä¿¡åŒºé—´)
function calculateStandardDeviation(data) {
    if (data.length < 2) return 0;
    const mean = data.reduce((a, b) => a + b, 0) / data.length;
    return Math.sqrt(data.reduce((sq, n) => sq + Math.pow(n - mean, 2), 0) / data.length);
}

function recursiveLayerPrediction(data, decay = 0.85) {
    let weightedSum = 0;
    let totalWeight = 0;

    for (let i = 0; i < data.length; i++) {
        const weight = Math.pow(decay, data.length - i - 1);
        weightedSum += data[i] * weight;
        totalWeight += weight;
    }

    return totalWeight === 0 ? 0 : weightedSum / totalWeight;
}

function simulateQuantumNoise(mean = 0, stdDev = 0.01, data = []) {
    // å¦‚æœæœ‰å†å²æ•°æ®ï¼Œåˆ™ç”¨å†å²æ•°æ®çš„æ ‡å‡†å·®
    if (Array.isArray(data) && data.length > 1) {
        stdDev = calculateStandardDeviation(data);
    }
    // Box-Muller transform ç”Ÿæˆé«˜æ–¯å™ªå£°
    let u = Math.random(), v = Math.random();
    let z = Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
    return mean + stdDev * z;
}

function predictFutureIncomeOrExpenses() {
    // ä½¿ç”¨è®ºæ–‡ä¸­çš„é€’å½’ç°å®ç”Ÿæˆæ¡†æ¶ (å…¬å¼4)
    const incomeData = incomeRecords.map(r => r.amount);
    const expenseData = expenseRecords.map(r => r.total);

    return {
        incomePrediction: recursiveRealityGeneration(incomeData, 7),  // ç°å®é€šé“ N_crit=7
        expensePrediction: recursiveRealityGeneration(expenseData, 23) // æ¢¦å¢ƒé€šé“ N_crit=23
    };
}

// è®ºæ–‡ä¸­çš„é€’å½’ç°å®ç”Ÿæˆç®—å­ (å…¬å¼4)
function recursiveRealityGeneration(data, N_crit) {
    if(data.length < 2) return { prediction: 0, lowerBound: 0, upperBound: 0 };
    
    // åˆå§‹åŒ–é€’å½’ç®—å­ R^(n)
    let R_prev = 0;
    let R_current = data[data.length - 1];
    
    // é€’å½’è®¡ç®— (ä½¿ç”¨è®ºæ–‡ä¸­çš„ç»ˆæ­¢æ¡ä»¶å…¬å¼5)
    for(let n=1; n<=N_crit; n++) {
        const R_next = R_current + 0.5 * (R_current - R_prev);
        
        // æ£€æŸ¥ç»ˆæ­¢æ¡ä»¶ (å…¬å¼5)
        const diff = Math.abs(R_next - R_current) / Math.abs(R_current);
        if(diff < 0.05) { // Îµ=0.05
            break;
        }
        
        R_prev = R_current;
        R_current = R_next;
    }
    
    // æ·»åŠ EDCPç›¸å˜å™ªå£° (å…¬å¼3)
    const noise = simulateEDCPNoise(data.length);
    const quantumNoise = simulateQuantumNoise(0, 0.01, data);
    const prediction = R_current * (1 + noise) + quantumNoise;
    
    // è®¡ç®—ç½®ä¿¡åŒºé—´
    const stdDev = calculateStandardDeviation(data) * (1 + noise);
    
    return {
        prediction: Math.max(0, prediction),
        lowerBound: Math.max(0, prediction - stdDev),
        upperBound: prediction + stdDev
    };
}

// æ¨¡æ‹ŸEDCPç›¸å˜å™ªå£° (åŸºäºè®ºæ–‡ä¸­çš„å…¬å¼3)
function simulateEDCPNoise(N_obs) {
    const Î³ = 2 * Math.sqrt(Ï‰0**2 - D); // ä¸´ç•Œé˜»å°¼ (å…¬å¼3)
    return Math.sqrt(2 * D / Î³) * (Math.random() - 0.5);
}

function updatePredictionUI() {
    const { incomePrediction, expensePrediction } = predictFutureIncomeOrExpenses();
    
    // æ›´æ–°æ”¶å…¥é¢„æµ‹æ˜¾ç¤º
    if (incomePrediction.prediction > 0) {
        document.getElementById('predictedIncome').innerHTML = `
            Predicted income for next month: 
            RM ${incomePrediction.prediction.toFixed(2)} 
            <small>(likely range: ${incomePrediction.lowerBound.toFixed(2)} - ${incomePrediction.upperBound.toFixed(2)})</small>
        `;
    } else {
        document.getElementById('predictedIncome').textContent =
            "Predicted income for next month: RM 0.00";
    }
    
    // æ›´æ–°æ”¯å‡ºé¢„æµ‹æ˜¾ç¤º
    if (expensePrediction.prediction > 0) {
        document.getElementById('predictedExpense').innerHTML = `
            Predicted expense for next month: 
            RM ${expensePrediction.prediction.toFixed(2)} 
            <small>(likely range: ${expensePrediction.lowerBound.toFixed(2)} - ${expensePrediction.upperBound.toFixed(2)})</small>
        `;
    } else {
        document.getElementById('predictedExpense').textContent =
            "Predicted expense for next month: RM 0.00";
    }
    
    // æ›´è¯¦ç»†çš„å»ºè®®
    let suggestion = "";
    if (incomePrediction.prediction === 0 && expensePrediction.prediction === 0) {
        suggestion = "Not enough data to make predictions. Please add more records.";
    } else {
        const remainingBudget = incomePrediction.prediction - expensePrediction.prediction;
        const safeThreshold = expensePrediction.prediction * 0.3;
        
        if (remainingBudget < -safeThreshold) {
            const deficit = -remainingBudget;
            suggestion = `Warning: Predicted deficit of RM ${deficit.toFixed(2)}. 
                          Consider reducing expenses by ${(deficit/expensePrediction.prediction*100).toFixed(1)}%.`;
        } else if (remainingBudget < safeThreshold) {
            suggestion = "Budget is tight. Consider limiting discretionary spending.";
        } else if (remainingBudget < expensePrediction.prediction * 0.5) {
            suggestion = "Budget looks balanced. You're doing well!";
        } else {
            suggestion = "Budget looks healthy. You might consider saving or investing the surplus.";
        }
    }
    
    document.getElementById('budgetSuggestion').innerHTML = suggestion;
}

// å›¾è¡¨å˜é‡
let expenseChart, incomeChart;

// æ›´æ–°å›¾è¡¨æ•°æ®
function updateCharts() {
    const { expenseData, incomeData } = categorizeData();

    if (expenseChart) {
        expenseChart.data.labels = Object.keys(expenseData);
        expenseChart.data.datasets[0].data = Object.values(expenseData);
        expenseChart.update();
    }

    if (incomeChart) {
        incomeChart.data.labels = Object.keys(incomeData);
        incomeChart.data.datasets[0].data = Object.values(incomeData);
        incomeChart.update();
    }
}

// æ•°æ®åˆ†ç±»å‡½æ•°
function categorizeData() {
    // æ”¶å…¥åˆ†ç±»
    const incomeCategories = {
        'å·¥èµ„': ['è–ªèµ„', 'å·¥èµ„'],
        'æŠ•èµ„': ['è‚¡ç¥¨', 'åŸºé‡‘', 'åˆ©æ¯'],
        'å…¼èŒ': ['å…¼èŒ', 'å‰¯ä¸š'],
        'å…¶ä»–': []
    };

    // æ”¯å‡ºåˆ†ç±»
    const expenseCategories = {
        'é£Ÿç‰©': ['é¤é¥®', 'é£Ÿæ', 'å¤–å–', 'é£Ÿå“', 'è¶…å¸‚'],
        'äº¤é€š': ['æ‰“è½¦', 'å…¬äº¤', 'æ²¹è´¹', 'åœ°é“', 'åœè½¦'],
        'å¨±ä¹': ['ç”µå½±', 'æ¸¸æˆ', 'æ—…è¡Œ', 'éŸ³ä¹', 'è®¢é˜…'],
        'å­¦ä¹ ': ['ä¹¦ç±', 'è¯¾ç¨‹', 'æ•™è‚²', 'åŸ¹è®­'],
        'å‚¨è“„': ['å­˜æ¬¾', 'æŠ•èµ„', 'ç†è´¢'],
        'å…¶ä»–': []
    };

    // ç»Ÿè®¡æ”¯å‡ºåˆ†ç±»
    const expenseData = {};
    Object.keys(expenseCategories).forEach(cat => {
        expenseData[cat] = 0;
    });

    expenseRecords.forEach(record => {
        if (record.category && expenseData.hasOwnProperty(record.category)) {
            expenseData[record.category] += record.total;
        } else {
            expenseData['å…¶ä»–'] += record.total;
        }
    });

    // ç»Ÿè®¡æ”¶å…¥åˆ†ç±»
    const incomeData = {};
    Object.keys(incomeCategories).forEach(cat => {
        incomeData[cat] = 0;
    });

    incomeRecords.forEach(record => {
        if (record.category && incomeData.hasOwnProperty(record.category)) {
            incomeData[record.category] += record.amount;
        } else {
            incomeData['å…¶ä»–'] += record.amount;
        }
    });

    return { expenseData, incomeData };
}

// å›¾è¡¨åˆå§‹åŒ–
function initCharts() {
    const { expenseData, incomeData } = categorizeData();

    // æ”¯å‡ºåˆ†ç±»å›¾è¡¨
    const expenseCtx = document.getElementById('expenseChart').getContext('2d');
    expenseChart = new Chart(expenseCtx, {
        type: 'doughnut',
        data: {
            labels: Object.keys(expenseData),
            datasets: [{
                data: Object.values(expenseData),
                backgroundColor: ['#9d00ff', '#00f0ff', '#6e00ff', '#ff00aa', '#00ffaa', '#ff9900'],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#fff',
                        font: {
                            family: 'Exo 2'
                        }
                    }
                }
            }
        }
    });

    // æ”¶å…¥æ¥æºå›¾è¡¨
    const incomeCtx = document.getElementById('incomeChart').getContext('2d');
    incomeChart = new Chart(incomeCtx, {
        type: 'pie',
        data: {
            labels: Object.keys(incomeData),
            datasets: [{
                data: Object.values(incomeData),
                backgroundColor: ['#9d00ff', '#00f0ff', '#6e00ff', '#ff00aa'],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#fff',
                        font: {
                            family: 'Exo 2'
                        }
                    }
                }
            }
        }
    });
}

// è‡ªå®šä¹‰æ—¥å†å®ç°
function initCustomCalendar() {
    const calendarDays = document.getElementById('calendar-days');
    const currentMonthYear = document.getElementById('current-month-year');
    const prevMonthBtn = document.getElementById('prev-month');
    const nextMonthBtn = document.getElementById('next-month');
    
    let currentDate = new Date();
    
    function renderCalendar() {
        // æ¸…é™¤ç°æœ‰æ—¥æœŸ
        calendarDays.innerHTML = '';
        
        // è®¾ç½®æœˆä»½å’Œå¹´ä»½æ ‡é¢˜
        const monthNames = ["January", "February", "March", "April", "May", "June",
                          "July", "August", "September", "October", "November", "December"];
        currentMonthYear.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
        
        // è·å–å½“æœˆç¬¬ä¸€å¤©å’Œæœ€åä¸€å¤©
        const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
        const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
        
        // è·å–ç¬¬ä¸€å¤©æ˜¯æ˜ŸæœŸå‡ ï¼ˆ0-6ï¼Œ0æ˜¯æ˜ŸæœŸæ—¥ï¼‰
        const firstDayIndex = firstDay.getDay();
        
        // è·å–ä¸Šä¸ªæœˆçš„æœ€åå‡ å¤©
        const prevLastDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0).getDate();
        
        // è·å–ä¸‹ä¸ªæœˆçš„å‰å‡ å¤©
        const nextDays = 7 - lastDay.getDay() - 1;
        
        // åˆ›å»ºæ—¥æœŸæ ¼å­
        let days = "";
        
        // ä¸Šä¸ªæœˆçš„æ—¥æœŸ
        for (let x = firstDayIndex; x > 0; x--) {
            days += `<div class="prev-date">${prevLastDay - x + 1}</div>`;
        }
        
        // æœ¬æœˆçš„æ—¥æœŸ
        for (let i = 1; i <= lastDay.getDate(); i++) {
            // æ£€æŸ¥ä»Šå¤©
            const isToday = i === new Date().getDate() && 
                           currentDate.getMonth() === new Date().getMonth() && 
                           currentDate.getFullYear() === new Date().getFullYear();
            
            // æ£€æŸ¥æ˜¯å¦æœ‰äº‹ä»¶
            const dateStr = `${currentDate.getFullYear()}-${(currentDate.getMonth()+1).toString().padStart(2, '0')}-${i.toString().padStart(2, '0')}`;
            const hasEvent = hasEventsOnDate(dateStr);
            
            days += `<div class="${isToday ? 'today' : ''} ${hasEvent ? 'has-event' : ''}" data-date="${dateStr}">${i}</div>`;
        }
        
        // ä¸‹ä¸ªæœˆçš„æ—¥æœŸ
        for (let j = 1; j <= nextDays; j++) {
            days += `<div class="next-date">${j}</div>`;
        }
        
        calendarDays.innerHTML = days;
        
        // æ·»åŠ ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('#calendar-days > div[data-date]').forEach(day => {
            day.addEventListener('click', () => {
                const date = day.getAttribute('data-date');
                showDayEvents(date);
            });
        });
    }
    
    function hasEventsOnDate(date) {
        // æ£€æŸ¥æ”¶å…¥è®°å½•
        const hasIncome = incomeRecords.some(record => record.date === date);
        // æ£€æŸ¥æ”¯å‡ºè®°å½•
        const hasExpense = expenseRecords.some(record => record.date === date);
        // æ£€æŸ¥æé†’
        const hasReminder = reminders.some(reminder => reminder.date === date);
        
        return hasIncome || hasExpense || hasReminder;
    }
    
    function showDayEvents(date) {
        const events = [];
        
        // æ”¶é›†æ”¶å…¥äº‹ä»¶
        incomeRecords.filter(record => record.date === date).forEach(record => {
            events.push({
                type: 'income',
                text: `Income: ${record.source} (RM${record.amount.toFixed(2)})`,
                color: '#00f0ff'
            });
        });
        
        // æ”¶é›†æ”¯å‡ºäº‹ä»¶
        expenseRecords.filter(record => record.date === date).forEach(record => {
            events.push({
                type: 'expense',
                text: `Expense: ${record.name} (RM${record.total.toFixed(2)})`,
                color: '#9d00ff'
            });
        });
        
        // æ”¶é›†æé†’
        reminders.filter(reminder => reminder.date === date).forEach(reminder => {
            events.push({
                type: 'reminder',
                text: `Reminder: ${reminder.text}`,
                color: '#ff00aa'
            });
        });
        
        if (events.length === 0) {
            showQuantumAlert(`No Events on ${date}`, 'There are no financial events on this date.');
            return;
        }
        
        const eventList = events.map(event => 
            `<li style="color: ${event.color}">${event.text}</li>`
        ).join('');
        
        showQuantumAlert(`Events on ${date}`, `<ul>${eventList}</ul>`);
    }
    
    // æœˆä»½å¯¼èˆª
    prevMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
    });
    
    nextMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
    });
    
    // åˆå§‹æ¸²æŸ“
    renderCalendar();
}

// è¾…åŠ©å‡½æ•°ï¼šç¡®ä¿æ—¥æœŸæ ¼å¼ä¸ºYYYY-MM-DD
function formatDate(dateString) {
    if (!dateString) return new Date().toISOString().split('T')[0];
    return new Date(dateString).toISOString().split('T')[0];
}

function updateRemindersCount() {
    const today = new Date().toISOString().split('T')[0];
    const upcoming = reminders.filter(r => r.date >= today).length;
    document.getElementById('upcoming-events').textContent = upcoming;
}

function renderRemindersList() {
    const listEl = document.getElementById('reminders-list');
    listEl.innerHTML = '';
    
    const today = new Date().toISOString().split('T')[0];
    const sortedReminders = [...reminders].sort((a, b) => a.date.localeCompare(b.date));
    
    sortedReminders.forEach(reminder => {
        const reminderEl = document.createElement('div');
        reminderEl.className = `reminder-item ${reminder.date < today ? 'past' : ''}`;
        
        reminderEl.innerHTML = `
            <span class="reminder-date">${reminder.date}</span>
            <span class="reminder-text">${reminder.text}</span>
            <button class="delete-reminder" 
                    onclick="deleteReminder('${reminder.date}', '${reminder.text.replace(/'/g, "\\'")}')">
                Ã—
            </button>
        `;
        
        listEl.appendChild(reminderEl);
    });
    
    updateRemindersCount();
}

function deleteReminder(date, text) {
    reminders = reminders.filter(r => !(r.date === date && r.text === text));
    saveDataToLocalStorage();
    renderRemindersList();
    renderCalendar(); // Refresh calendar to update event indicators
}

// é¢„ç®—è­¦å‘Šç³»ç»Ÿ
function checkBudgetWarnings() {
    const totalIncome = incomeRecords.reduce((sum, r) => sum + r.amount, 0);
    const totalExpenses = expenseRecords.reduce((sum, r) => sum + r.total, 0);
    const remaining = totalIncome - totalExpenses;
    
    // ä½¿ç”¨è®ºæ–‡ä¸­çš„ç†µå·®åˆ†å´©æºƒç‚¹(EDCP)åˆ†æ
    const S_income = calculateEntropy(incomeRecords.map(r => r.amount));
    const S_expense = calculateEntropy(expenseRecords.map(r => r.total));
    const Î”S = S_income - S_expense;
    
    // ä¸´ç•Œç›¸å˜é˜ˆå€¼ (è®ºæ–‡ä¸­çš„Î²_crit=1.23)
    const Î² = Math.abs(Î”S) / (S_income + S_expense);
    
    if(Î² > 1.23) {
        showQuantumAlert('âš ï¸ é‡å­è´¢åŠ¡ç›¸å˜é¢„è­¦', 
            `æ£€æµ‹åˆ°ç†µå·®åˆ†å´©æºƒç‚¹(EDCP)ï¼è´¢åŠ¡ç³»ç»Ÿå¤„äºä¸´ç•ŒçŠ¶æ€ (Î²=${Î².toFixed(2)})ã€‚
            å»ºè®®ç«‹å³è°ƒæ•´æ”¶æ”¯å¹³è¡¡ä»¥é¿å…é‡å­é€€ç›¸å¹²ã€‚`, '#ff0000');
    } else if(remaining < 0) {
        showQuantumAlert('âš ï¸ é¢„ç®—èµ¤å­—', 
            `æ”¯å‡ºè¶…è¿‡æ”¶å…¥ RM${Math.abs(remaining).toFixed(2)}ã€‚
            å½“å‰ç†µæ¯” Î²=${Î².toFixed(2)}`, '#ff6b6b');
    } else if(Î² > 0.8) {
        showQuantumAlert('ğŸ”” é«˜ç†µè­¦å‘Š', 
            `è´¢åŠ¡ç³»ç»Ÿç†µå€¼è¿‡é«˜ (Î²=${Î².toFixed(2)})ã€‚
            å»ºè®®ç¨³å®šç°é‡‘æµä»¥å‡å°‘ä¸ç¡®å®šæ€§ã€‚`, '#ffcc00');
    }
    
    // æ£€æŸ¥å®šæœŸæé†’
    checkReminders();
}

// è®¡ç®—é¦™å†œç†µ
function calculateEntropy(data) {
    if(data.length === 0) return 0;
    
    const total = data.reduce((sum, x) => sum + x, 0);
    if(total === 0) return 0;
    
    let entropy = 0;
    data.forEach(x => {
        const p = x / total;
        if(p > 0) entropy += -p * Math.log(p);
    });
    
    return entropy;
}

function showQuantumAlert(title, message, color = '#00f0ff') {
    const alertEl = document.createElement('div');
    alertEl.style.position = 'fixed';
    alertEl.style.top = '20px';
    alertEl.style.left = '50%';
    alertEl.style.transform = 'translateX(-50%)';
    alertEl.style.zIndex = '2000';
    alertEl.style.padding = '15px';
    alertEl.style.background = 'rgba(10, 10, 32, 0.9)';
    alertEl.style.border = `2px solid ${color}`;
    alertEl.style.borderRadius = '8px';
    alertEl.style.boxShadow = `0 0 15px ${color}`;
    alertEl.style.maxWidth = '80%';
    alertEl.style.color = '#fff';
    alertEl.style.textAlign = 'center';
    
    alertEl.innerHTML = `
        <h3 style="margin-top: 0; color: ${color}">${title}</h3>
        <p style="white-space: pre-line;">${message}</p>
        <button onclick="this.parentElement.remove()" 
                style="background: ${color}; border: none; padding: 5px 10px; 
                border-radius: 4px; cursor: pointer; margin-top: 10px;">
            OK
        </button>
    `;
    
    document.body.appendChild(alertEl);
    
    // è‡ªåŠ¨æ¶ˆå¤±
    setTimeout(() => {
        if (alertEl.parentNode) {
            alertEl.remove();
        }
    }, 10000);
}

// é‡å­æ„è¯†å¯è§†åŒ– - ä½¿ç”¨RQCMè®ºæ–‡ç®—æ³•
function renderQuantumViz() {
    // ä»¥é¢„ç®—æ•°æ®ä¸ºè¾“å…¥ï¼Œæ¨¡æ‹ŸRQCMè®ºæ–‡çš„é€’å½’ç°å®ç”Ÿæˆç®—å­ä¸å±€éƒ¨ç†µäº§ç”Ÿ
    const N_obs = Math.max(3, Math.floor((incomeRecords.length + expenseRecords.length) / 2) || 3);
    const N_crit = Math.ceil(Math.log((incomeRecords.length + expenseRecords.length + 1) || 1) * 10);
    const entropyRate = calculateLocalEntropyProduction(N_obs);
    const temporalResolution = TEMPORAL_RESOLUTION;

    // æ›´æ–°æŒ‡æ ‡
    document.getElementById('observerLayers').textContent = N_obs;
    document.getElementById('entropyRate').textContent = entropyRate.toExponential(2);
    document.getElementById('temporalResolution').textContent = temporalResolution.toExponential(2);

    // å¯è§†åŒ–ç½‘ç»œ
    const viz = document.getElementById('quantum-viz');
    viz.innerHTML = '';
    const width = viz.offsetWidth || 400;
    const height = viz.offsetHeight || 180;
    const centerX = width / 2;
    const centerY = height / 2;
    const radius = Math.min(width, height) / 2.5;

    // ç”ŸæˆèŠ‚ç‚¹
    let nodes = [];
    for (let i = 0; i < N_obs; i++) {
        const angle = (2 * Math.PI * i) / N_obs;
        const x = centerX + radius * Math.cos(angle);
        const y = centerY + radius * Math.sin(angle);
        nodes.push({ x, y, name: `L${i+1}` });
        // èŠ‚ç‚¹
        const nodeDiv = document.createElement('div');
        nodeDiv.className = 'quantum-node' + (i < N_crit ? ' quantum-highlight' : '');
        nodeDiv.style.left = `${x}px`;
        nodeDiv.style.top = `${y}px`;
        nodeDiv.title = `Layer ${i+1}`;
        viz.appendChild(nodeDiv);
    }
    // ç”Ÿæˆè¿æ¥
    for (let i = 0; i < N_obs; i++) {
        const n1 = nodes[i];
        const n2 = nodes[(i+1)%N_obs];
        const link = document.createElement('div');
        link.className = 'quantum-link';
        const dx = n2.x - n1.x;
        const dy = n2.y - n1.y;
        const length = Math.sqrt(dx*dx + dy*dy);
        link.style.left = `${n1.x}px`;
        link.style.top = `${n1.y}px`;
        link.style.width = `${length}px`;
        link.style.transform = `rotate(${Math.atan2(dy, dx)}rad)`;
        viz.appendChild(link);
    }
}

// RQCMè®ºæ–‡ä¸­çš„å±€éƒ¨ç†µäº§ç”Ÿå…¬å¼ (å…¬å¼2)
function calculateLocalEntropyProduction(N_obs) {
    // SÌ‡ = Î»L * N_obs * tP / hbar
    return Î»L * N_obs * tP / hbar;
}

// é‡å­åˆ†ææŒ‰é’®
document.getElementById('quantum-analyze').addEventListener('click', function() {
    // ä½¿ç”¨RQCMè®ºæ–‡ç®—æ³•åˆ†æ
    const N_obs = Math.max(3, Math.floor((incomeRecords.length + expenseRecords.length) / 2) || 3);
    const N_crit = Math.ceil(Math.log((incomeRecords.length + expenseRecords.length + 1) || 1) * 10);
    const entropyRate = calculateLocalEntropyProduction(N_obs);
    const temporalResolution = TEMPORAL_RESOLUTION;

    let message = `RQCM Analysis\n\n`;
    message += `Observer Layers: ${N_obs}\n`;
    message += `Critical Layers (N_crit): ${N_crit}\n`;
    message += `Entropy Rate: ${entropyRate.toExponential(2)}\n`;
    message += `Temporal Resolution: ${temporalResolution.toExponential(2)} s\n\n`;
    message += `According to the RQCM theory, if Observer Layers > N_crit, the system approaches a critical transition (EDCP). Monitor entropy rate and budget fluctuations for quantum stability.`;

    showQuantumAlert('RQCM Quantum Analysis', message, '#00f0ff');
});

// é¡µé¢åŠ è½½å’Œçª—å£å˜åŒ–æ—¶æ¸²æŸ“
window.addEventListener('load', renderQuantumViz);
window.addEventListener('resize', throttle(renderQuantumViz, 300));

// äº‹ä»¶ç›‘å¬
document.getElementById("addIncomeBtn").addEventListener("click", addIncome);
document.getElementById("addItemBtn").addEventListener("click", addExpense);
document.getElementById("clearDataBtn").addEventListener("click", clearData);
document.getElementById("filterBtn").addEventListener("click", filterRecords);
document.getElementById("predictBtn").addEventListener("click", updatePredictionUI);
document.getElementById("add-reminder").addEventListener("click", function() {
    const date = document.getElementById("reminder-date").value;
    const text = document.getElementById("reminder-text").value.trim();
    
    if (!date || !text) {
        showQuantumAlert('Error', 'Please fill in both date and reminder text', '#ff6b6b');
        return;
    }
    
    // Check for duplicate reminders
    const duplicate = reminders.some(r => r.date === date && r.text === text);
    if (duplicate) {
        showQuantumAlert('Notice', 'This reminder already exists', '#ffcc00');
        return;
    }
    
    reminders.push({ date, text });
    saveDataToLocalStorage();
    
    document.getElementById("reminder-date").value = '';
    document.getElementById("reminder-text").value = '';
    
    renderRemindersList();
    renderCalendar(); // Refresh calendar to show new reminder
    showQuantumAlert('Success', 'Reminder added successfully', '#00f0ff');
});

// æ³¨å†ŒService Worker
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
            .then(registration => {
                console.log('ServiceWorker registration successful');
            })
            .catch(err => {
                console.log('ServiceWorker registration failed: ', err);
            });
    });
}

// æ·»åŠ åˆ°ä¸»å±å¹•æç¤º
let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    
    // å¯ä»¥åœ¨è¿™é‡Œæ˜¾ç¤ºä¸€ä¸ª"æ·»åŠ åˆ°ä¸»å±å¹•"çš„æŒ‰é’®
    const installButton = document.createElement('button');
    installButton.textContent = 'å®‰è£…NENWAåº”ç”¨';
    installButton.className = 'btn';
    installButton.style.margin = '10px auto';
    installButton.style.display = 'block';
    installButton.onclick = () => {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === 'accepted') {
                console.log('User accepted the install prompt');
            } else {
                console.log('User dismissed the install prompt');
            }
            deferredPrompt = null;
        });
    };
    
    const welcomeSection = document.querySelector('.welcome-content');
    if (welcomeSection) {
        welcomeSection.appendChild(installButton);
    }
});

// åˆå§‹åŒ–
window.addEventListener('load', function() {
    document.body.classList.add('loaded');
    manageSakura();
    loadDataFromLocalStorage();
    
    // å¡ç‰‡å…¥åœºåŠ¨ç”»
    const cards = document.querySelectorAll('.welcome-card');
    cards.forEach((card, index) => {
        card.style.transition = `all 0.5s ease ${index * 0.1}s`;
        setTimeout(() => {
            card.classList.add('visible');
        }, 100);
    });
    
    // æ·»åŠ æŒ‰é’®ç‚¹å‡»åŠ¨ç”»
    document.querySelectorAll('button, .btn, a').forEach(btn => {
        btn.addEventListener('click', function() {
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = '';
            }, 200);
        });
    });
    
    // ç§»åŠ¨ç«¯è¡¨æ ¼ä¼˜åŒ–
    addDataLabelsToMobileTables();
    
    // ä¸ºå®½è¡¨æ ¼æ·»åŠ æ»šåŠ¨å®¹å™¨
    const tables = document.querySelectorAll('table');
    tables.forEach(table => {
        if (table.offsetWidth > window.innerWidth * 0.9) {
            const wrapper = document.createElement('div');
            wrapper.className = 'scrollable-table';
            table.parentNode.insertBefore(wrapper, table);
            wrapper.appendChild(table);
        }
    });
    
    // åˆå§‹åŒ–å›¾è¡¨å’Œæ—¥å†
    initCharts();
    initCustomCalendar();
    
    // æ£€æŸ¥é¢„ç®—è­¦å‘Š
    setTimeout(checkBudgetWarnings, 2000);
});

window.addEventListener('resize', function() {
    if (window.innerHeight < 500) {
        const activeInput = document.activeElement;
        if (activeInput.tagName === 'INPUT') {
            activeInput.scrollIntoView({ block: 'center' });
        }
    }
    throttledRenderQuantumViz();
});

// ç§»åŠ¨ç«¯è¡¨æ ¼æ·»åŠ æ•°æ®æ ‡ç­¾
function addDataLabelsToMobileTables() {
    if (window.innerWidth > 768) return;
    
    const incomeTable = document.getElementById('incomeTable');
    const expenseTable = document.getElementById('expenseTable');
    
    // ä¸ºæ”¶å…¥è¡¨æ ¼æ·»åŠ æ•°æ®æ ‡ç­¾
    if (incomeTable) {
        const headers = incomeTable.querySelectorAll('thead th');
        const cells = incomeTable.querySelectorAll('tbody td');
        
        headers.forEach((header, index) => {
            const label = header.textContent;
            cells.forEach((cell, cellIndex) => {
                if (cellIndex % headers.length === index) {
                    cell.setAttribute('data-label', label);
                }
            });
        });
    }
    
    // ä¸ºæ”¯å‡ºè¡¨æ ¼æ·»åŠ æ•°æ®æ ‡ç­¾
    if (expenseTable) {
        const headers = expenseTable.querySelectorAll('thead th');
        const cells = expenseTable.querySelectorAll('tbody td');
        
        headers.forEach((header, index) => {
            const label = header.textContent;
            cells.forEach((cell, cellIndex) => {
                if (cellIndex % headers.length === index) {
                    cell.setAttribute('data-label', label);
                }
            });
        });
    }
}

// çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°åº”ç”¨æ ‡ç­¾
window.addEventListener('resize', addDataLabelsToMobileTables);
</script>
</body>
</html>